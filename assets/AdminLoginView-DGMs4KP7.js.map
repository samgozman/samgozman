{"version":3,"file":"AdminLoginView-DGMs4KP7.js","sources":["../../src/views/AdminLoginView.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { ref, onMounted } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { StorageKeeper } from '@/services/StorageKeeper'\nimport { BloggyApi } from '@/services/BloggyApi'\nimport HeaderMax from '@/components/elements/HeaderMax.vue'\n\nwindow.document.title = 'Login | Sam Gozman'\n\nconst router = useRouter()\n\n// Token TTL in milliseconds\nconst ttl = Number(import.meta.env.VITE_AUTH_TOKEN_TTL_SECONDS) * 1000\nconst clientId = import.meta.env.VITE_GITHUB_CLIENT_ID\nconst errorCode = ref()\nconst errorMessage = ref()\n\nonMounted(async () => {\n  const urlParams = new URLSearchParams(window.location.search)\n  const code = urlParams.get('code')\n\n  if (!code) {\n    return\n  }\n\n  try {\n    const res = await BloggyApi.login(code)\n    if (!res.ok) {\n      errorCode.value = res.code\n      errorMessage.value = res.message\n      return\n    }\n\n    const expireTime = new Date().getTime() + ttl\n    StorageKeeper.set<string>('token', res.token, expireTime)\n\n    router.push({ name: 'admin-dashboard' })\n  } catch (error) {\n    errorCode.value = 'unexpected-error'\n    errorMessage.value = error\n  }\n})\n</script>\n\n<template>\n  <HeaderMax value=\"ðŸ‘¾ Admin login.\" />\n\n  <div class=\"w-full\">\n    <a class=\"btn\" :href=\"`https://github.com/login/oauth/authorize?client_id=${clientId}`\">\n      <ion-icon name=\"logo-github\" class=\"text-xl\"></ion-icon>\n      Authenticate with GitHub\n    </a>\n    <div v-if=\"errorCode && errorMessage\" role=\"alert\" class=\"alert alert-error mt-4\">\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        class=\"stroke-current shrink-0 h-6 w-6\"\n        fill=\"none\"\n        viewBox=\"0 0 24 24\"\n      >\n        <path\n          stroke-linecap=\"round\"\n          stroke-linejoin=\"round\"\n          stroke-width=\"2\"\n          d=\"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z\"\n        />\n      </svg>\n      <span>\n        <strong>Message:</strong> {{ errorMessage }}. <strong>Code:</strong> {{ errorCode }}.\n      </span>\n    </div>\n  </div>\n</template>\n"],"names":["router","useRouter","ttl","clientId","errorCode","ref","errorMessage","onMounted","code","res","BloggyApi","expireTime","StorageKeeper","error"],"mappings":"gqBAOA,OAAO,SAAS,MAAQ,qBAExB,MAAMA,EAASC,IAGTC,EAAM,GAAsD,IAC5DC,EAAW,uBACXC,EAAYC,IACZC,EAAeD,IAErB,OAAAE,EAAU,SAAY,CAEd,MAAAC,EADY,IAAI,gBAAgB,OAAO,SAAS,MAAM,EACrC,IAAI,MAAM,EAEjC,GAAKA,EAID,GAAA,CACF,MAAMC,EAAM,MAAMC,EAAU,MAAMF,CAAI,EAClC,GAAA,CAACC,EAAI,GAAI,CACXL,EAAU,MAAQK,EAAI,KACtBH,EAAa,MAAQG,EAAI,QACzB,MACF,CAEA,MAAME,EAAa,IAAI,KAAK,EAAE,UAAYT,EAC1CU,EAAc,IAAY,QAASH,EAAI,MAAOE,CAAU,EAExDX,EAAO,KAAK,CAAE,KAAM,iBAAmB,CAAA,QAChCa,EAAO,CACdT,EAAU,MAAQ,mBAClBE,EAAa,MAAQO,CACvB,CAAA,CACD"}