{"version":3,"file":"SubscribeConfirmView-B55rJo9H.js","sources":["../../src/views/subscriptions/SubscribeConfirmView.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { onMounted, ref } from 'vue'\nimport VueHcaptcha from '@hcaptcha/vue3-hcaptcha'\nimport ArticleProse from '@/components/elements/ArticleProse.vue'\nimport { BloggyApi } from '@/services/BloggyApi'\n\nwindow.document.title = 'Subscription status  | Sam Gozman'\n\nconst hCaptchaKey = import.meta.env.VITE_HCAPTCHA_SITE_KEY\n\nconst captchaToken = ref('')\nconst captcha = ref<VueHcaptcha>()\nconst error = ref('')\n\nconst onCaptchaVerified = (t: string) => {\n  captchaToken.value = t\n}\n\nconst onCaptchaExpired = () => {\n  captchaToken.value = ''\n}\n\nonMounted(async () => {\n  if (!captcha.value) {\n    return\n  }\n\n  // Get `token` from url query param\n  const url = new URL(window.location.href)\n  const confirmationToken = url.searchParams.get('token')\n  if (!confirmationToken) {\n    error.value = 'Invalid token'\n    return\n  }\n\n  try {\n    await captcha.value.executeAsync()\n\n    const res = await BloggyApi.confirmSubscription(confirmationToken, captchaToken.value)\n    if (!res.ok) {\n      return\n    }\n\n    error.value = ''\n  } catch (err) {\n    error.value = 'Failed to confirm subscription'\n    console.error(err)\n  }\n})\n</script>\n\n<template>\n  <ArticleProse>\n    <h2>Subscription confirmation:</h2>\n    <p v-if=\"error\" class=\"text-error\">{{ error }}</p>\n    <p v-else>You have successfully subscribed to my blog! ðŸ§¡</p>\n  </ArticleProse>\n\n  <vue-hcaptcha\n    ref=\"captcha\"\n    :sitekey=\"hCaptchaKey\"\n    size=\"invisible\"\n    @verify=\"onCaptchaVerified\"\n    @expired=\"onCaptchaExpired\"\n  ></vue-hcaptcha>\n</template>\n"],"names":["hCaptchaKey","captchaToken","ref","captcha","error","onCaptchaVerified","t","onCaptchaExpired","onMounted","confirmationToken","BloggyApi","err"],"mappings":"2QAMA,OAAO,SAAS,MAAQ,oCAElB,MAAAA,EAAc,uCAEdC,EAAeC,EAAI,EAAE,EACrBC,EAAUD,IACVE,EAAQF,EAAI,EAAE,EAEdG,EAAqBC,GAAc,CACvCL,EAAa,MAAQK,CAAA,EAGjBC,EAAmB,IAAM,CAC7BN,EAAa,MAAQ,EAAA,EAGvB,OAAAO,EAAU,SAAY,CAChB,GAAA,CAACL,EAAQ,MACX,OAKF,MAAMM,EADM,IAAI,IAAI,OAAO,SAAS,IAAI,EACV,aAAa,IAAI,OAAO,EACtD,GAAI,CAACA,EAAmB,CACtBL,EAAM,MAAQ,gBACd,MACF,CAEI,GAAA,CAIE,GAHE,MAAAD,EAAQ,MAAM,eAGhB,EADQ,MAAMO,EAAU,oBAAoBD,EAAmBR,EAAa,KAAK,GAC5E,GACP,OAGFG,EAAM,MAAQ,SACPO,EAAK,CACZP,EAAM,MAAQ,iCACd,QAAQ,MAAMO,CAAG,CACnB,CAAA,CACD"}